# 推送消息插件

## 思路

> 用于消息及时推送，用户消息中心查询

### sse 进行实时推送

notify_event 表

|     column     | 说明    |  类型   | 作用                           |
| :------------: | ------- | :-----: | ------------------------------ |
|       id       | id      |   int   | id 值                          |
|    group_id    | 分组 id |   int   | 所属的分组 id                  |
| message_events | 事件    | varchar | 所属分组拥有那些事件的接收权限 |

### 数据库记录用户信息

notify_message

|  column   | 说明     |   类型    | 作用                                                 |
| :-------: | -------- | :-------: | ---------------------------------------------------- |
|    id     | id       |    int    | id 值                                                |
|  message  | 消息内容 |  varchar  | 记录消息的内容                                       |
|   event   | 消息事件 |  varchar  | 记录消息的所属事件                                   |
|   time    | 消息时间 | timestamp | 记录消息的创建时间                                   |
|  pushed   | 已被推送 |  tinyint  | 标识消息是否已被推送                                 |
|  readed   | 已被阅读 |  tinyint  | 标识消息是否已被阅读                                 |
|  user_id  | 用户 id  |    int    | 消息所属的用户 id                                    |
| user_name | 用户名   |  varchar  | 消息所属的用户昵称(用户昵称可能被修改，因此记录快照) |

### 具体业务流程

event 表用于分配权限组拥有的事件，一个权限组可以拥有多个事件，即在权限组的用户拥有多个事件的接收权限，没有某个事件权限的用户不能接收服务器发送的该事件。

message 表用于记录用户已经接收到的消息，用户是否已经阅读，已经具体消息的内容和事件，方便在前端的消息中心进行展现。
